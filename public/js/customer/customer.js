$(document).ready((function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var e=4,t=1,a=0,s=1,r="customer-management/table";function d(e){var t=e.from,a=e.to,s=e.total,r=e.from,d="";$.each(e.data,(function(e,t){1==t.is_active&&(active="Đang hoạt động"),0==t.is_active&&(active="Tạm khóa"),d=(d=(d=(d=(d=(d=(d=(d=(d=(d=(d=d+'<tr id="customer'+t.customer_id+'" data-id="'+t.customer_id+'">')+"<td>"+r+++"</td>")+'<input type="hidden" name="customer_id" value="'+t.customer_id+'">')+'<td class="edit'+t.customer_id+'" name="customer_name" id="editName'+t.customer_id+'">'+t.customer_name+"</td>")+'<td class="edit'+t.customer_id+'" name="email" id="editEmail'+t.customer_id+'">'+t.email+"</td>")+'<td class="edit'+t.customer_id+'" name="addess" id="editAddress'+t.customer_id+'">'+t.address+"</td>")+'<td class="edit'+t.customer_id+'" name="te_num" id="editTelNum'+t.customer_id+'">'+t.tel_num+"</td>")+'<td data-id="'+t.customer_id+'">')+'<a class="editCustomer btn btn-success" id="editCustomer'+t.customer_id+'" data-id="'+t.customer_id+'" title="Chỉnh sửa"><i class="fas fa-edit"></i></a>')+'<a class="updateCustomer btn btn-primary d-none" id="updateCustomer'+t.customer_id+'" data-id="'+t.customer_id+'" title="Update"><i class="fas fa-save"></i> Lưu</a>')+'<a class="cancelCustomer btn btn-danger d-none" id="cancelCustomer'+t.customer_id+'" data-id="'+t.customer_id+'" title="Update"><i class="fas fa-window-close"></i> Hủy</a>',d+="</td>",d+="</tr>"})),$("tbody").html(d),$("#show").html("Hiển thị từ "+t+" đến "+a+" trong tổng số "+s+" khách hàng")}$.ajax({dataType:"json",url:r,data:{page:e}}).done((function(i){a=i.last_page,t=i.current_page,$("#pagination").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:a,visiblePages:t,onPageClick:function(t,a){e=a,0!=s&&$.ajax({dataType:"json",url:r,data:{page:e}}).done((function(e){d(e)}))}}),d(i.data),s=1})),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".search").click((function(e){e.preventDefault();var t=$("#search_name").val(),a=$("#search_email").val(),s=$("#search_address").val(),r=$("#is_active").val(),d="/customer-management/search?search_name="+t+"&search_email="+a+"&is_active="+r+"&search_address="+s,i="/customer-management/export?search_name="+t+"&search_email="+a+"&is_active="+r+"&search_address="+s;$("#export").attr("href",i),$("#export").removeClass("d-none"),$("#exportdefault").addClass("d-none"),$.ajax({type:"GET",url:"/customer-management/search?search_name="+t+"&search_email="+a+"&is_active="+r+"&search_address="+s,dataType:"json",data:$(this).serialize(),success:function(e){$("#search_name").prop("disabled",!0),$("#search_email").prop("disabled",!0),$("#search_address").prop("disabled",!0),$("#is_active").prop("disabled",!0);var t=5,a=0,s=1;function r(e){if(0==e)$(".del").html('<h1 style="margin-left:30%">Không có dữ liệu</h1>');else{var t=e.from,a="";$.each(e.data,(function(e,s){1==s.is_active&&(active="Đang hoạt động"),0==s.is_active&&(active="Tạm khóa"),a=(a=(a=(a=(a=(a=(a=(a=(a=(a=(a=a+'<tr id="customer'+s.customer_id+'" data-id="'+s.customer_id+'">')+"<td>"+t+++"</td>")+'<input type="hidden" name="customer_id" value="'+s.customer_id+'">')+'<td class="edit'+s.customer_id+'" name="customer_name" id="editName'+s.customer_id+'">'+s.customer_name+"</td>")+'<td class="edit'+s.customer_id+'" name="email" id="editEmail'+s.customer_id+'">'+s.email+"</td>")+'<td class="edit'+s.customer_id+'" name="addess" id="editAddress'+s.customer_id+'">'+s.address+"</td>")+'<td class="edit'+s.customer_id+'" name="te_num" id="editTelNum'+s.customer_id+'">'+s.tel_num+"</td>")+'<td data-id="'+s.customer_id+'">')+'<a class="editCustomer btn btn-success" id="editCustomer'+s.customer_id+'" data-id="'+s.customer_id+'" title="Chỉnh sửa"><i class="fas fa-edit"></i></a>')+'<a class="updateCustomer btn btn-primary d-none" id="updateCustomer'+s.customer_id+'" data-id="'+s.customer_id+'" title="Update"><i class="fas fa-save"></i> Lưu</a>')+'<a class="cancelCustomer btn btn-danger d-none" id="cancelCustomer'+s.customer_id+'" data-id="'+s.customer_id+'" title="Update"><i class="fas fa-window-close"></i> Hủy</a>',a+="</td>",a+="</tr>"})),$("tbody").html(a),$("#pagination").hide(),$("#paginationSearch").removeClass("d-none")}}a=e.last_page,e.current_page,$("#paginationSearch").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:a,visiblePages:5,onPageClick:function(e,a){t=a,0!=s&&$.ajax({dataType:"json",url:d,data:{page:t,visiblePages:5}}).done((function(e){r(e)}))}}),r(e.data),s=1},error:function(e){console.log(e)}}),$.ajax({type:"GET",url:"/customer-management/export?search_name="+t+"&search_email="+a+"&is_active="+r+"&search_address="+s,data:{search_name:t,search_emai:a,is_active:r,search_address:s},success:function(e){},error:function(e){console.log(e)}})})),$(".deleteSearch").click((function(e){location.reload()})),$("#createCustomer").on("submit",(function(e){e.preventDefault();var t=$("#customer_name").val(),a=$("#email").val(),s=$("#address").val(),r=$("#tel_num").val();$.ajax({type:"POST",url:"/customer-management",data:{customer_name:t,email:a,address:s,tel_num:r},success:function(e){alert("Thêm mới thành công")},error:function(e){var t=e.responseJSON.errors.customer_name,a=e.responseJSON.errors.email,s=e.responseJSON.errors.tel_num,r=e.responseJSON.errors.address;$.isEmptyObject(t)&&$("#errorName").html(""),$("#errorName").html(t),$.isEmptyObject(a)&&$("#errorEmail").html(""),$("#errorEmail").html(a),$.isEmptyObject(s)&&$("#errorTelNum").html(""),$("#errorTelNum").html(s),$.isEmptyObject(r)&&$("#errorAddress").html(""),$("#errorAddress").html(r)}})})),$("#createModal").on("hidden.bs.modal",(function(e){$(".error").html("")})),$("body").on("click",".editCustomer",(function(e){var t=$(this).attr("data-id");e.preventDefault(),$(".edit"+t).attr("contentEditable","true"),$(".edit"+t).attr("onkeypress","return event.keyCode != 13;"),$("#customer"+t).addClass("edit"),$(".editCustomer").addClass("d-none"),$("#updateCustomer"+t).removeClass("d-none"),$("#cancelCustomer"+t).removeClass("d-none")})),$("body").on("click",".updateCustomer",(function(){var e=$(this).attr("data-id"),t=$("#editName"+e).html(),a=$("#editEmail"+e).html(),s=$("#editAddress"+e).html(),r=$("#editTelNum"+e).html();$.ajax({type:"POST",url:"/customer-management/edit/"+e,data:{customer_name:t,email:a,address:s,tel_num:r},success:function(t){$(".edit"+e).attr("contentEditable","false"),$("#customer"+e).removeClass("edit"),$(".editCustomer").removeClass("d-none"),$("#updateCustomer"+e).addClass("d-none"),$("#cancelCustomer"+e).addClass("d-none"),alert("Cập nhập thành công")},error:function(e){var t=e.responseJSON.errors.customer_name,a=e.responseJSON.errors.email,s=e.responseJSON.errors.tel_num,r=e.responseJSON.errors.address;$.isEmptyObject(t)||alert(t),$.isEmptyObject(a)||alert(a),$.isEmptyObject(s)||alert(s),$.isEmptyObject(r)||alert(r)}})})),$("body").on("click",".cancelCustomer",(function(){var e=$(this).attr("data-id");$(".edit"+e).attr("contentEditable","false"),$("#customer"+e).removeClass("edit"),$(".editCustomer").removeClass("d-none"),$("#updateCustomer"+e).addClass("d-none"),$("#cancelCustomer"+e).addClass("d-none")}));var i=window.location.href+"/autocompletename";$(".search_name").typeahead({source:function(e,t){return $.get(i,{search_name:e},(function(e){return t(e)}))}});var n=window.location.href+"/autocompleteemail";$(".search_email").typeahead({source:function(e,t){return $.get(n,{search_email:e},(function(e){return t(e)}))}});var o=window.location.href+"/autocompleteaddress";$(".search_address").typeahead({source:function(e,t){return $.get(o,{search_address:e},(function(e){return t(e)}))}})}));