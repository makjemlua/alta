$(document).ready((function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var a=5,e=1,t=0,r=1,i="/user-management/search";function s(){$.ajax({dataType:"json",url:i,data:{page:a}}).done((function(a){n(a)}))}function n(a){var e=a.from,t=a.to,r=a.total,i=a.from,s="";$.each(a.data,(function(a,e){1==e.is_active&&(active="Đang hoạt động"),0==e.is_active&&(active="Tạm khóa"),s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s+'<tr id="url'+e.id+'">')+'<td class="stt">'+i+++"</td>")+"<td>"+e.name+"</td>")+"<td>"+e.email+"</td>")+"<td>"+e.group_role+"</td>")+'<td id="active'+e.id+'" class="active'+e.is_active+'">'+active+"</td>")+'<td data-id="'+e.id+'">')+'<a class="updateUser btn btn-success" data-toggle="modal" data-target="#editModal" id="'+e.id+'" title="Chỉnh sửa"><i class="fas fa-edit"></i></a>')+'<a  class="deleteUser btn btn-danger" id="'+e.id+'" data-name="'+e.name+'" href="" title="Xóa"><i class="fas fa-trash-alt"></i></a>')+'<a class="activeUser btn btn-warning" id="'+e.id+'" data-name="'+e.name+'" href="" data-active="'+e.is_active+'" title="Trạng thái"><i class="fas fa-user-times"></i></a>',s+="</td>",s+="</tr>"})),$("tbody").html(s),$("#show").html("Hiển thị từ "+e+" đến "+t+" trong tổng số "+r+" user")}$.ajax({dataType:"json",url:i,data:{page:a}}).done((function(i){t=i.last_page,e=i.current_page,$("#pagination").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:t,visiblePages:e,onPageClick:function(e,t){a=t,0!=r&&s()}}),n(i.data),r=1})),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".search").click((function(a){a.preventDefault();var e=5,t=0,r=1,i=$("#search_name").val(),s=$("#search_email").val(),n=$("#group_role").val(),o=$("#is_active").val();$.ajax({type:"GET",url:"/user-management/search",dataType:"json",data:{search_name:i,search_email:s,group_role:n,is_active:o},success:function(a){function i(a){if(0==a)$(".del").html('<h1 style="margin-left:30%">Không có dữ liệu</h1>');else{var e=a.from,t="";$.each(a.data,(function(a,r){1==r.is_active&&(active="Đang hoạt động"),0==r.is_active&&(active="Tạm khóa"),t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t+'<tr id="url'+r.id+'">')+"<td>"+e+++"</td>")+"<td>"+r.name+"</td>")+"<td>"+r.email+"</td>")+"<td>"+r.group_role+"</td>")+'<td id="active'+r.id+'" class="active'+r.is_active+'">'+active+"</td>")+'<td data-id="'+r.id+'">')+'<a class="updateUser btn btn-success" data-toggle="modal" data-target="#editModal" id="'+r.id+'" title="Chỉnh sửa"><i class="fas fa-edit"></i></a>')+'<a class="deleteUser btn btn-danger" id="'+r.id+'" data-name="'+r.name+'" href="" title="Xóa"><i class="fas fa-trash-alt"></i></a>')+'<a class="activeUser btn btn-warning" id="'+r.id+'" data-name="'+r.name+'" href="" data-active="'+r.is_active+'" title="Trạng thái"><i class="fas fa-user-times"></i></a>',t+="</td>",t+="</tr>"})),$("tbody").html(t),$("#pagination").hide(),$("#paginationSearch").removeClass("d-none")}}$("#search_name").prop("disabled",!0),$("#search_email").prop("disabled",!0),$("#group_role").prop("disabled",!0),$("#is_active").prop("disabled",!0),t=a.last_page,a.current_page,$("#paginationSearch").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:t,visiblePages:5,onPageClick:function(a,t){e=t,0!=r&&function(){var a=$("#search_name").val(),t=$("#search_email").val(),r=$("#group_role").val(),s=$("#is_active").val();$.ajax({dataType:"json",url:"/user-management/search",data:{page:e,search_name:a,search_email:t,group_role:r,is_active:s,visiblePages:5}}).done((function(a){i(a)}))}()}}),i(a.data),r=1},error:function(a){console.log(a)}})})),$(".deleteSearch").click((function(a){location.reload()})),$("body").on("click",".updateUser",(function(){var a=$(this).parent("td").data("id");$.ajax({url:"user-management/edit/"+a,dataType:"json",success:function(a){$("#editName").val(a.name),$("#editEmail").val(a.email),$("#editPassword").attr("data-password",a.password),$("#editGroup").attr("data-group",a.group_role),$("#editIs_active").attr("data-active",a.is_active);for(var e=1;e<=3;e++)a.group_role==$(".editsGroup"+e).val()&&$(".editsGroup"+e).attr("selected",!0);1==a.is_active&&$(".editIs_active").attr("checked",!0),$("#userId").val(a.id)}})})),$("body").on("click",".deleteUser",(function(a){a.preventDefault();var e=$(this).attr("id"),t=$(this).attr("data-name");confirm("Bạn có muốn xóa thành viên "+t+"?")&&$.ajax({url:"user-management/delete/"+e,type:"GET",data:$(this).serialize(),success:function(a){$("#url"+e).remove(),alert("Đã xóa thành công")},error:function(a){console.log(a)}})})),$("body").on("click",".activeUser",(function(a){a.preventDefault();var e=$(this).attr("id"),t=$(this).attr("data-name"),r=$(this).attr("data-active");0==r&&(r="Mở khóa"),1==r&&(r="Khóa"),confirm("Bạn có muốn "+r+" thành viên "+t+"?")&&$.ajax({url:"user-management/active/"+e,type:"GET",data:$(this).serialize(),success:function(a){$("#active"+e).hasClass("active1")?($("#active"+e).html("Tạm khóa"),$("#active"+e).removeClass("active1")):($("#active"+e).html("Đang hoạt động"),$("#active"+e).addClass("active1"))},error:function(a){console.log(a)}})})),$("#createUser").on("submit",(function(a){a.preventDefault(),$.ajax({type:"POST",url:"/user-management",data:$("#createUser").serialize(),success:function(a){$("#createModal").modal("hide"),alert("Thêm user thành công")},error:function(a){var e=a.responseJSON.errors.name,t=a.responseJSON.errors.email,r=a.responseJSON.errors.password,i=a.responseJSON.errors.repassword;$.isEmptyObject(e)&&$("#errorName").html(""),$("#errorName").html(e),$.isEmptyObject(t)&&$("#errorEmail").html(""),$("#errorEmail").html(t),$.isEmptyObject(r)&&$("#errorPassword").html(""),$("#errorPassword").html(r),$.isEmptyObject(i)&&$("#errorRepassword").html(""),$("#errorRepassword").html(i)}})})),$("#createModal").on("hidden.bs.modal",(function(a){$(".error").html("")})),$("#editModal").on("hidden.bs.modal",(function(a){$(".editsGroup1, .editsGroup2, .editsGroup3").removeAttr("selected"),$(".editIs_active").removeAttr("checked"),$("#editPassword").val(""),$("#editRepassword").val(""),$(".error").html("")})),$("#editUser").on("submit",(function(a){var e=$("#userId").val(),t=$("#editName").val(),r=$("#editPassword").attr("data-password"),i=$("#editEmail").val(),n=$("#editPassword").val(),o=$("#editRepassword").val(),d=$("#editGroup").val(),c=$("#editIs_active").is(":checked");c=1==c?"1":"0",a.preventDefault(),$.ajax({type:"POST",url:"/user-management/edit/"+e,data:{name:t,email:i,password:n,repassword:o,password_old:r,editGroup_role:d,editIs_active:c},success:function(a){s(),$("#editModal").modal("hide"),alert("Cập nhập thành công")},error:function(a){var e=a.responseJSON.errors.name,t=a.responseJSON.errors.email,r=a.responseJSON.errors.password,i=a.responseJSON.errors.repassword;$.isEmptyObject(e)&&$("#errorNameEdit").html(""),$("#errorNameEdit").html(e),$.isEmptyObject(t)&&$("#errorEmailEdit").html(""),$("#errorEmailEdit").html(t),$.isEmptyObject(r)&&$("#errorPasswordEdit").html(""),$("#errorPasswordEdit").html(r),$.isEmptyObject(i)&&$("#errorRepasswordEdit").html(""),$("#errorRepasswordEdit").html(i)}})}));var o=window.location.href+"/autocompletename";$(".search_name").typeahead({source:function(a,e){return $.get(o,{search_name:a},(function(a){return e(a)}))}});var d=window.location.href+"/autocompleteemail";$(".search_email").typeahead({source:function(a,e){return $.get(d,{search_email:a},(function(a){return e(a)}))}})}));