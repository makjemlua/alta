$(document).ready((function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});var t=5,a=1,e=0,r=1,d="/order-management/search";function n(t){window.location.origin;var a=window.location.href,e=t.from,r=t.to,d=t.total,n=t.from,s="",o=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});$.each(t.data,(function(t,e){1==e.payment_method&&(payment_method="COD"),2==e.payment_method&&(payment_method="Paypal"),3==e.payment_method&&(payment_method="GMO"),1==e.order_status&&(order_status="Paid",status="btn-success",title="Đã thanh toán"),0==e.order_status&&(order_status="Unpaid",status="btn-danger",title="Chưa thanh toán");var r=e.total_price+e.ship_charge+e.tax;s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s+'<tr id="url'+e.order_id+'">')+'<td class="stt">'+n+++"</td>")+"<td>"+e.customer.customer_name+"</td>")+"<td>"+e.customer.email+"</td>")+"<td>"+payment_method+"</td>")+"<td>"+e.orderdate+"</td>")+'<td><a class="status btn '+status+'" title="'+title+'">'+order_status+"</a></td>")+"<td>"+o.format(e.total_price)+"</td>")+"<td>"+e.ship_charge+"</td>")+"<td>"+e.tax+"</td>")+"<td>"+o.format(r)+"</td>")+'<td data-id="'+e.id+'">')+'<a class="viewOrder btn btn-success" data-id="'+e.order_id+'" href="'+a+"/order-detail/"+e.order_id+'" title="Xem chi tiết"><i class="fas fa-eye"></i></a>')+'<a class="pdfOrder btn btn-secondary" id="'+e.order_id+'" href="'+a+"/generate-pdf/"+e.order_id+'" title="In PDF"><i class="fas fa-file-pdf"></i></a>')+'<a class="deleteOrder btn btn-danger" id="'+e.order_id+'" title="Xóa"><i class="fas fa-trash-alt"></i></a>',s+="</td>",s+="</tr>"})),$("tbody").html(s),$("#show").html("Hiển thị từ "+e+" đến "+r+" trong tổng số "+d+" sản phẩm")}$.ajax({dataType:"json",url:d,data:{page:t}}).done((function(s){e=s.last_page,a=s.current_page,$("#pagination").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:e,visiblePages:a,onPageClick:function(a,e){t=e,0!=r&&$.ajax({dataType:"json",url:d,data:{page:t}}).done((function(t){n(t)}))}}),n(s.data),r=1})),$("body").on("click",".deleteOrder",(function(t){t.preventDefault();var a=$(this).attr("id");confirm("Bạn có muốn xóa sản phẩm đơn hàng này không ?")&&$.ajax({url:"order-management",type:"GET",data:$(this).serialize(),success:function(t){$("#url"+a).remove(),alert("Đã xóa thành công")},error:function(t){console.log(t)}})})),$(".searchs").click((function(t){t.preventDefault();var a=5,e=0,r=1,n=$("#search_name").val(),s=$("#search_email").val();console.log(s);var o=$("#payment_method").val(),i=$("#order_status").val();$.ajax({type:"GET",url:"/order-management/search",dataType:"json",data:{search_name:n,search_email:s,payment_method:o,order_status:i},success:function(t){function n(t){var a=t.from,e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"});if(0==t)$(".del").html('<h1 style="margin-left:30%">Không có dữ liệu</h1>');else{var r="";$.each(t,(function(t,n){1==n.payment_method&&(o="COD"),2==n.payment_method&&(o="Paypal"),3==n.payment_method&&(o="GMO"),1==n.order_status&&(i="Paid",status="btn-success",title="Đã thanh toán"),0==n.order_status&&(i="Unpaid",status="btn-danger",title="Chưa thanh toán");var s=n.total_price+n.ship_charge+n.tax;r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r+'<tr id="url'+n.order_id+'">')+'<td class="stt">'+a+++"</td>")+"<td>"+n.customer.customer_name+"</td>")+"<td>"+n.customer.email+"</td>")+"<td>"+o+"</td>")+"<td>"+n.shipment_date+"</td>")+'<td><a class="status btn '+status+'" title="'+title+'">'+i+"</a></td>")+"<td>"+e.format(n.total_price)+"</td>")+"<td>"+n.ship_charge+"</td>")+"<td>"+n.tax+"</td>")+"<td>"+e.format(s)+"</td>")+"<td>"+n.note_customer+"</td>")+'<td data-id="'+n.id+'">')+'<a class="viewOrder btn btn-success" data-id="'+n.order_id+'" href="'+d+"/order-detail/"+n.order_id+'" title="Xem chi tiết"><i class="fas fa-eye"></i></a>')+'<a class="deleteOrder btn btn-danger" id="'+n.order_id+'" title="Xóa"><i class="fas fa-trash-alt"></i></a>',r+="</td>",r+="</tr>"})),$("tbody").html(r),$("#pagination").hide(),$("#paginationSearch").removeClass("d-none")}}$("#search_name").prop("disabled",!0),$("#search_email").prop("disabled",!0),$("#payment_method").prop("disabled",!0),$("#order_status").prop("disabled",!0),e=t.last_page,t.current_page,$("#paginationSearch").twbsPagination({first:"<<",prev:"<",next:">",last:">>",totalPages:e,visiblePages:5,onPageClick:function(t,e){a=e,0!=r&&function(){var t=$("#search_name").val(),e=$("#search_email").val(),r=$("#payment_method").val(),d=$("#order_status").val();$.ajax({dataType:"json",url:"/order-management/search",data:{page:a,search_name:t,search_email:e,payment_method:r,order_status:d,visiblePages:5}}).done((function(t){n(t.data)}))}()}}),n(t.data),r=1},error:function(t){console.log(t)}})})),$(".deleteSearch").click((function(t){location.reload()})),$("body").on("click",".viewOrder",(function(t){t.preventDefault();var a=$(this),e=a.attr("href");$(".transaction_id").text("").text(a.attr("data-id")),$("#myModalOrder").modal("show"),$.ajax({url:e}).done((function(t){t&&$("#md_content").html("").append(t)}))}))}));